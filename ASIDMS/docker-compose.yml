version: '3.8'

services:

  # === USER SERVICE ===
  userdb:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: userdb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    volumes:
      - userdb_data:/var/lib/mysql

  userms:
    build: ./userms
    container_name: userms
    depends_on:
      - userdb
    environment:
      SPRING_DATASOURCE_URL: jdbc:mariadb://userdb:3306/userdb
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    ports:
      - "8081:8080"

  # === BOOK SERVICE ===
  bookdb:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: bookdb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    volumes:
      - bookdb_data:/var/lib/mysql

  bookms:
    build: ./bookms
    container_name: bookms
    depends_on:
      - bookdb
    environment:
      SPRING_DATASOURCE_URL: jdbc:mariadb://bookdb:3306/bookdb
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    ports:
      - "8082:8080"

  # === CART SERVICE ===
  cartdb:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: cartdb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    volumes:
      - cartdb_data:/var/lib/mysql

  cartms:
    build: ./cartms
    container_name: cartms
    depends_on:
      - cartdb
    environment:
      SPRING_DATASOURCE_URL: jdbc:mariadb://cartdb:3306/cartdb
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    ports:
      - "8083:8080"

  # === ORDER SERVICE ===
  orderdb:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: orderdb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    volumes:
      - orderdb_data:/var/lib/mysql

  orderms:
    build: ./orderms
    container_name: orderms
    depends_on:
      - orderdb
    environment:
      SPRING_DATASOURCE_URL: jdbc:mariadb://orderdb:3306/orderdb
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    ports:
      - "8084:8080"

  # === SHIPPING SERVICE ===
  shippingdb:
    image: mariadb:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: shippingdb
      MYSQL_USER: user
      MYSQL_PASSWORD: password
    volumes:
      - shippingdb_data:/var/lib/mysql

  shippingms:
    build: ./shippingms
    container_name: shippingms
    depends_on:
      - shippingdb
    environment:
      SPRING_DATASOURCE_URL: jdbc:mariadb://shippingdb:3306/shippingdb
      SPRING_DATASOURCE_USERNAME: user
      SPRING_DATASOURCE_PASSWORD: password
    ports:
      - "8085:8080"

volumes:
  userdb_data:
  bookdb_data:
  cartdb_data:
  orderdb_data:
  shippingdb_data:
